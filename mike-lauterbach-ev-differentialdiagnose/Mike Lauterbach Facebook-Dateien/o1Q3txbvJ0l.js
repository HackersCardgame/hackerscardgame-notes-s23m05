;/*FB_PKG_DELIM*/

__d("createCometUFIMediaAttachmentPreview",["fbt","ix","CometAccessibilityAnnouncement.react","CometPlaceholder.react","CometRow.react","CometRowItem.react","CometUFIMediaUploadProgressBar.react","JSResourceForInteraction","TetraIcon.react","TetraText.react","fbicon","lazyLoadComponent","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=c("lazyLoadComponent")(c("JSResourceForInteraction")("CometUFIOptimisticVideoComment.react").__setRef("createCometUFIMediaAttachmentPreview"));function a(a,b){switch(a.__type){case"UploadedFile":switch(a.kind){case"file":return{contents:j.jsxs(c("CometRow.react"),{paddingHorizontal:16,paddingVertical:16,spacing:8,testid:void 0,verticalAlign:"center",children:[j.jsx(c("CometRowItem.react"),{children:j.jsx(c("TetraIcon.react"),{color:"primary",icon:d("fbicon")._(i("511753"),24)})}),j.jsx(c("CometRowItem.react"),{expanding:!0,children:j.jsx(c("TetraText.react"),{type:"body2",children:a.previewMarkup})})]}),removeButtonLabel:h._("__JHASH__yWAQVcol8aE__JHASH__")};case"photo":return{contents:j.jsxs(j.Fragment,{children:[j.jsx(c("CometAccessibilityAnnouncement.react"),{role:"status",children:h._("__JHASH__ArQXez6JwR2__JHASH__")}),j.jsx("div",{dangerouslySetInnerHTML:{__html:a.previewMarkup}})]}),removeButtonLabel:h._("__JHASH__NQkgevgIJF1__JHASH__")};case"video":return{contents:j.jsxs(c("CometPlaceholder.react"),{fallback:j.jsx(c("CometUFIMediaUploadProgressBar.react"),{label:h._("__JHASH__AoQAbcMN3Ju__JHASH__",[h._param("value","100")]),value:100}),children:[j.jsx(c("CometAccessibilityAnnouncement.react"),{role:"status",children:h._("__JHASH__ZD-576voVwj__JHASH__")}),j.jsx(k,{isVideoFileTranscodedGIF:!!a.isTranscodedGIF,progress:100,shouldCondenseVideoPreview:b,videoFileURL:a.previewURL==null||a.previewURL===""?void 0:a.previewURL})]}),removeButtonLabel:a.isTranscodedGIF?h._("__JHASH__cR8MJSFZBru__JHASH__"):h._("__JHASH__YDoqVKgMdc8__JHASH__")};default:a.kind}return null;case"File":return{contents:j.jsx(c("CometUFIMediaUploadProgressBar.react"),{label:h._("__JHASH__AoQAbcMN3Ju__JHASH__",[h._param("value","0")]),value:0}),removeButtonLabel:h._("__JHASH__M0Eks8PkfAq__JHASH__")};case"UploadingFile":var e=h._("__JHASH__M0Eks8PkfAq__JHASH__");switch(a.kind){case"file":case"photo":var f=parseInt(a.progress*100,10);return{contents:j.jsx(c("CometUFIMediaUploadProgressBar.react"),{label:h._("__JHASH__AoQAbcMN3Ju__JHASH__",[h._param("value",String(f))]),value:f}),removeButtonLabel:e};case"video":return{contents:j.jsx(c("CometPlaceholder.react"),{fallback:j.jsx(c("CometUFIMediaUploadProgressBar.react"),{label:h._("__JHASH__AoQAbcMN3Ju__JHASH__",[h._param("value","0")]),value:0}),children:j.jsx(k,{isVideoFileTranscodedGIF:!!a.isTranscodedGIF,progress:Math.round(a.progress*100),shouldCondenseVideoPreview:b,videoFileURL:a.previewURL==null||a.previewURL===""?void 0:a.previewURL})}),removeButtonLabel:e};default:}return null;case"EncodingFile":return null;default:return null}}g["default"]=a}),98);
__d("getMediaAttachmentFromUFIComposerState",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=a==null?void 0:a.attachment;return a&&a.__type==="Media"?a:null}f["default"]=a}),66);
__d("useCometUFIMediaUploadHandler",["FBLogger","asyncToGeneratorRuntime","err","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";e=d("react");var h=e.useCallback,i=e.useEffect,j=e.useMemo,k=e.useRef;function a(a){var d=a.actorId,e=a.lightweightGroupMediaUploadLogger,f=a.pluginProps,g=f.addAttachmentMapper,l=f.addCommitListener,m=f.commentAction,r=f.composerState,s=f.mediaUploadError,t=f.setComposerState,u=f.setMediaUploadError,v=a.supported,w=k(null),x=k(null),y=h(function(){var a=x.current,b=function(a){e==null?void 0:e.logMediaUploadCancel(a)};a==null?void 0:a.cancel(b);t(function(){return{attachment:null}})},[e,t]),z=h(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=n(r);if(a==null){c("FBLogger")("ufi2").warn("The `startUpload` method was called, but no file was present in `composerState`.");return null}s!==null&&u(null);function b(a,b,c){t(function(){return{attachment:null}}),u(a),e==null?void 0:e.logMediaUploadFailure(a,b,c)}var f=function(a){e==null?void 0:e.logMediaUploadFlowStart(a),e==null?void 0:e.logMediaUploadStart(a),e==null?void 0:e.logMediaUploadProcessStart(a),e==null?void 0:e.logMediaUploadTransferStart(a),e==null?void 0:e.logMediaUploadProcessSuccess(a)},g=function(a,b){e==null?void 0:e.logMediaUploadFlowSuccess(a,b),e==null?void 0:e.logMediaUploadSuccess(a,b),e==null?void 0:e.logMediaUploadTransferSuccess(a,b)};for(var h of v)if(yield h.isFileType(new File([a],"file",{type:a.type}))){h.upload({actorId:d,commentAction:m,composerState:r,file:a,onFailure:b,onUploadStart:f,onUploadSuccess:g,setComposerState:t});return h}return null}),[d,m,r,s,e,t,u,v]);i(function(){return g(function(a){if(a.__type==="Media"&&a.reference.__type==="EncodingFile")return{media:{id:a.reference.id}};return a.__type==="Media"&&a.reference.__type==="UploadedFile"?{media:{id:a.reference.id}}:null})},[g]);i(function(){var a=w.current;a!=null&&(q(r,a)||p(r,a))&&y();(a===null&&n(r)!=null||a!==null&&o(r,a))&&c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield z());a?x.current=a:(u(c("err")("Unsupported File")),y())})())},[y,r,u,z]);i(function(){w.current=r});i(function(){return l(function(){var a=r.attachment;if((a==null?void 0:a.__type)==="Media"&&(a==null?void 0:a.reference.__type)==="UploadedFile"&&(a==null?void 0:(a=a.reference)==null?void 0:a.kind)==="video")for(a of v)a.commit(t);return"continue-commit"})},[l,r,r.attachment,t,v]);return j(function(){return[y]},[y])}function l(a){a=a==null?void 0:a.attachment;return a&&a.__type==="Media"?a:null}function m(a){a=l(a);return a==null?void 0:(a=a.reference)==null?void 0:a.__type}function n(a){a=l(a);return a&&a.reference.__type==="File"?a.reference.file:null}function o(a,b){a=n(a);return a!=null&&n(b)!==a}function p(a,b){b=m(b);return b==="UploadingFile"&&!["UploadingFile","UploadedFile"].includes(m(a))}function q(a,b){return l(b)!=null&&l(a)==null}g["default"]=a}),98);
__d("cometIsFileTypeForMedia",["FBLogger","UFICommentFileInputAcceptValues","asyncToGeneratorRuntime","genIsNonAnimatedWebPFile"],(function(a,b,c,d,e,f,g){"use strict";var h={file:null,photo:null,video:null};function i(a){return a.split(",").map(function(a){return a.trim()}).map(function(a){return a.replace(/\/\*$/,"/")})}function j(a,b,d){h[a]==null&&(h[a]=i(d));d=h[a];if(d==null)throw c("FBLogger")("ufi2").mustfixThrow("CometIsMimeTypeForMedia prefixes can't be null");return d.some(function(a){return b.startsWith(a)})}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.type;if(b==="image/gif")return!1;else if(b==="image/webp")return c("genIsNonAnimatedWebPFile")(a);return j("photo",b,d("UFICommentFileInputAcceptValues").photos)});return k.apply(this,arguments)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.type;if(a==="image/gif")return!0;else if(a==="image/webp")return!1;return j("video",a,d("UFICommentFileInputAcceptValues").videos)});return l.apply(this,arguments)}function f(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.type;return j("file",a,d("UFICommentFileInputAcceptValues").files)});return m.apply(this,arguments)}g.mimeTypeAcceptStringToArray=i;g.isFileTypeForPhoto=a;g.isFileTypeForVideo=e;g.isFileTypeForFile=f}),98);
__d("spread",[],(function(a,b,c,d,e,f){"use strict";function a(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return Object.assign.apply(Object,[{},a].concat(c))}f["default"]=a}),66);
__d("CometUFIMediaUploadPhoto",["ActorURI","FBLogger","cometAsyncFetch","cometIsFileTypeForMedia","promiseDone","spread"],(function(a,b,c,d,e,f,g){"use strict";var h="PHOTO";function i(a){a=a==null?void 0:a.attachment;return a&&a.__type==="Media"?a:null}a=function(){function a(){this.$1=null}var b=a.prototype;b.upload=function(a){var b=this,e=a.actorId,f=a.file,g=a.onFailure,j=a.onUploadStart,k=a.onUploadSuccess,l=a.setComposerState;l(function(){return{attachment:{__type:"Media",reference:{__type:"UploadingFile",kind:"photo",progress:0}}}});j(h);a=new FormData();a.append("file",f);e=(j={},j[d("ActorURI").PARAMETER_ACTOR]=e,j.profile_id=e,j.source=19,j.target_id=e,j);function m(a){if(a==null){var b=new Error("Unexpectedly empty payload");g(b,h);return}var d=a.fbid,e=a.markupPreview;k(d,h);l(function(a){var b=i(a);if(b==null){c("FBLogger")("ufi2").warn("A photo comment finished uploading but the `composerState` no longer contains a media attachment. Make sure that we are tearing down the `AsyncRequest`.");return null}return babelHelpers["extends"]({},a,{attachment:babelHelpers["extends"]({},b,{reference:{__type:"UploadedFile",id:String(d),kind:"photo",previewMarkup:e.markup.__html,previewURL:URL.createObjectURL?URL.createObjectURL(f):null}})})})}j=function(a){var c=a.loadedBytes;a=a.totalBytes;c=a>0?c/a:0;b.$2(l,c||0)};var n=new AbortController(),o=n.signal,p=function(a){var b=a.errorMsg;a=a.errorType;if(a==="Abort"&&o.aborted)return;a=new Error(a||"Unknown error");b&&(a.description=String(b));g(a,h)};e=c("cometAsyncFetch")("/ajax/ufi/upload/",{abortSignal:o,data:e,formData:a,method:"POST",onUploadProgress:j});c("promiseDone")(e,function(a){return m(a)},p);this.$1={remove:function(){n.abort()}}};b.$2=function(a,b){var d=this;a(function(a){var e=i(a);if(e==null){c("FBLogger")("ufi2").warn("Received an upload progress event but the `composerState` no longer contains a media attachment. Make sure that we are tearing down any subscriptions that call `updateUploadProgress()`.");return null}var f=d.$3(a);if(f==null){c("FBLogger")("ufi2").warn("Received an upload progress event but the media attachment present in `composerState` is no longer of the type `UploadingFile`. Make sure that we are tearing down any subscriptions that call `updateUploadProgress()`.");return null}return babelHelpers["extends"]({},a,{attachment:babelHelpers["extends"]({},e,{reference:c("spread")(f,{progress:b})})})})};b.$3=function(a){a=i(a);return a&&a.reference.__type==="UploadingFile"&&a.reference.kind==="photo"?a.reference:null};b.cancel=function(a){a(h);if(this.$1===null)return!1;this.$1.remove();this.$1=null;return!0};b.isFileType=function(a){return d("cometIsFileTypeForMedia").isFileTypeForPhoto(a)};b.commit=function(){return};return a}();g["default"]=a}),98);
__d("CancelablePromise",["Promise","promiseDone"],(function(a,b,c,d,e,f,g){a=function(){function a(a){var d=this;this.$1=new(b("Promise"))(function(b,e){d.$3=e,c("promiseDone")(a.then(function(a){return d.$2?e({isCanceled:!0,message:"canceled",result:a}):b(a)})["catch"](function(a){return d.$2?e({isCanceled:!0,message:"canceled"}):e(a)}))});this.$2=!1}var d=a.prototype;d.getPromise=function(){return this.$1};d.cancel=function(){this.$2=!0};d.reject=function(a){this.cancel(),this.$3==null?void 0:this.$3(a)};return a}();g["default"]=a}),98);
__d("XVideoInCommentUploadController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/video/in_comment_upload/",{})}),null);
__d("CometUFIMediaUploadVideo",["invariant","ActorURI","CancelablePromise","FBLogger","SubscriptionsHandler","VideoUploadFile","VideoUploadFlowNotifier","VideoUploadSurface","VideoUploader","XVideoInCommentUploadController","cometAsyncFetch","cometIsFileTypeForMedia","err","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i="VIDEO";function j(a){a=a==null?void 0:a.attachment;return a&&a.__type==="Media"?a:null}function k(a){a=j(a);return a&&a.reference.__type==="UploadedFile"&&a.reference.kind==="video"?a.reference:null}function l(a){a=j(a);return a&&a.reference.__type==="UploadingFile"&&a.reference.kind==="video"&&a.reference.phase==="uploading"?a.reference:null}a=function(){function a(){this.$1=null,this.$2=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null}var b=a.prototype;b.upload=function(a){var b=this,e=a.actorId,f=a.commentAction,g=a.composerState,k=a.file,m=a.onFailure,n=a.onUploadStart,o=a.onUploadSuccess,p=a.setComposerState;a=d("ActorURI").create(c("XVideoInCommentUploadController").getURIBuilder().getURI(),e);p(function(){return{attachment:{__type:"Media",reference:{__type:"UploadingFile",isTranscodedGIF:k.type==="image/gif",kind:"video",phase:"uploading",previewURL:URL.createObjectURL?URL.createObjectURL(k):null,progress:0}}}});n(i);var q=null,r=new(c("SubscriptionsHandler"))(),s=!1;function t(){if(s===!0)return;s=!0;r.release()}var u=function(a){if(a==null)throw c("unrecoverableViolation")("Could not obtain video uploader config with which to upload video comment","ufi2");a=a.video_uploader[0];q=new(c("VideoUploader"))(a);a=d("VideoUploadFlowNotifier").createVideoUploadFlowNotifier({cancel_on_leave:!1,cancel_on_unload:!1,composer_entry_point_ref:a.composer_entry_point_ref,extended_flow_logging_enabled:a.extended_flow_logging_comments_enabled,source:a.source,target_id:a.target_id,target_type:a.target_type});var e=[f,g==null?void 0:g.feedbackID].join("_");a.registerVideoUpload(q,e);d("VideoUploadSurface").VideoUploadSurface.getOrCreate(d("VideoUploadSurface").VideoUploadSurfaceIDs.COMMENTS).notifiers().register(a,e);r.addSubscriptions(q.subscribe("upload-progressed",function(a,c){a=Math.min(c.start_offset+c.sent_bytes,c.file_size);b.$7(p,a/c.file_size)}),q.subscribe("upload-finished",function(a,d){b.$4=d;a=String(d.video_id);o(a,i);p(function(a){var b,e=j(a),f=l(a);if(e==null){c("FBLogger")("ufi2").warn("The `upload-finished` event fired but the `composerState` no longer contains a media attachment. Make sure that we are tearing down the `VideoUploader` subscriptions.");return null}f!=null||h(0,56516,e.reference.__type,(b=e.reference.phase)!=null?b:"unknown");return babelHelpers["extends"]({},a,{attachment:babelHelpers["extends"]({},e,{reference:{__type:"UploadedFile",id:String(d.video_id),isTranscodedGIF:f.isTranscodedGIF,kind:"video",previewURL:f.previewURL}})})});b.$5=(a=q)!=null?a:null;q!=null||h(0,4134)}),q.subscribe("upload-failed",function(a,b){t();a=c("err")(b?b.error_summary:"Video upload failed");b&&(a.description=b.error_description);m(a,i)}));q.upload(c("VideoUploadFile").fromFile(k))},v=new(c("CancelablePromise"))(c("cometAsyncFetch")(a.toString()));c("promiseDone")(v.getPromise(),function(a){return u(a)});r.addSubscriptions({remove:function(){v.cancel()}});r.addSubscriptions({remove:function(){q&&q.abandon(s),q=null}});this.$1={remove:t};this.$2=f;this.$3=g.feedbackID;this.$6=r};b.$7=function(a,b){a(function(a){var d=j(a);if(d==null){c("FBLogger")("ufi2").warn("Received an upload progress event but the `composerState` no longer contains a media attachment. Make sure that we are tearing down any subscriptions that call `updateUploadProgress()`.");return null}var e=l(a);if(e==null){c("FBLogger")("ufi2").warn("Received an upload progress event but the media attachment present in `composerState` is no longer of the type `UploadingFile`. Make sure that we are tearing down any subscriptions that call `updateUploadProgress()`.");return null}return babelHelpers["extends"]({},a,{attachment:babelHelpers["extends"]({},d,{reference:babelHelpers["extends"]({},e,{progress:b})})})})};b.cancel=function(a){a(i);if(this.$1===null)return!1;this.$1.remove();this.$1=null;(this.$2===null||this.$3===null)&&c("FBLogger")("ufi2").mustfix("commentAction and feedbackID on CometUFIMediaUploadVideo can't be null when subscription is set");a=[this.$2,this.$3].join("_");d("VideoUploadSurface").VideoUploadSurface.getOrCreate(d("VideoUploadSurface").VideoUploadSurfaceIDs.COMMENTS).notifiers().getExistingOrNoOpByID(a).notifyOnUploadAction({action:d("VideoUploadFlowNotifier").VideoUploadActions.UPLOAD_USER_REMOVED,trackingID:a});return!0};b.commit=function(a){var b=this.$4,d=this.$5,e=this.$6;if(b===null||d==null||e==null)return;d.post(babelHelpers["extends"]({},this.$4,{video_container:0}));a(function(a){var d=j(a);if(d==null){c("FBLogger")("ufi2").warn("Received a publish request but the `composerState` no longer contains a media attachment.");return null}var e=k(a);if(e==null){c("FBLogger")("ufi2").warn("Received a publish request but the media attachment present in `composerState` is not of the type `UploadedFile`.");return null}return babelHelpers["extends"]({},a,{attachment:babelHelpers["extends"]({},d,{reference:{__type:"EncodingFile",id:String(b==null?void 0:b.video_id),isTranscodedGIF:e.isTranscodedGIF,kind:"video",previewURL:e.previewURL,progress:0}})})})};b.isFileType=function(a){return d("cometIsFileTypeForMedia").isFileTypeForVideo(a)};return a}();g["default"]=a}),98);
__d("useCometUFISupportedMediaUploader",["CometUFIMediaUploadPhoto","CometUFIMediaUploadVideo","cometUFIMediaUploadComposerPluginSupportedTypes","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useMemo;function a(){return h(function(){var a=[];for(var b=c("cometUFIMediaUploadComposerPluginSupportedTypes"),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;switch(f){case"photo":a.push(new(c("CometUFIMediaUploadPhoto"))());break;case"video":a.push(new(c("CometUFIMediaUploadVideo"))());break;default:f}}return a},[])}g["default"]=a}),98);
__d("CometUFIMediaUploadUpgradedPlugin.experimental.react",["fbt","CometUFIComposerPreviewArea.react","createCometUFIMediaAttachmentPreview","getMediaAttachmentFromUFIComposerState","react","unrecoverableViolation","useCometUFIMediaUploadHandler","useCometUFISupportedMediaUploader"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react");function a(a){var b=a.feedback,d=a.lightweightGroupMediaUploadLogger,e=a.pluginProps;a=a.shouldCondenseVideoPreview;var f=e.composerState,g=c("useCometUFISupportedMediaUploader")();b=(b=b.viewer_actor)==null?void 0:b.id;if(b==null)throw c("unrecoverableViolation")("You can't upload a file without an actor ID.","ufi2");b=c("useCometUFIMediaUploadHandler")({actorId:b,lightweightGroupMediaUploadLogger:d,pluginProps:e,supported:g});d=b[0];var j;e=c("getMediaAttachmentFromUFIComposerState")(f);if(e){g=e.reference;j=c("createCometUFIMediaAttachmentPreview")(g,a)}if(j==null)return null;b=j;f=b.contents;e=b.removeButtonLabel;return i.jsx("div",{className:"x1iyjqo2",children:i.jsx(c("CometUFIComposerPreviewArea.react"),{label:e,onRemove:d,removeAnnouncement:h._("__JHASH__DCnVVyMkCON__JHASH__"),children:f})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);